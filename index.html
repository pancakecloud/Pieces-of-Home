<style>
  #webcamButton {
    position: absolute;
    z-index: 999;
  }
  
  #output_canvas, video {
    display:none;
  }
</style>
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

<link
  href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
  rel="stylesheet"
/>
<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

<body>
  <div id="liveView" class="videoView">
    <button id="webcamButton" class="mdc-button mdc-button--raised">
      <span class="mdc-button__ripple"></span>
      <span class="mdc-button__label">ENABLE WEBCAM</span>
    </button>
    <div style="position: relative">
      <video
        id="webcam"
        style="width: 1280px; height: 720px; position: abso"
        autoplay
        playsinline
      ></video>
      <canvas
        class="output_canvas"
        id="output_canvas"
        width="1280"
        height="720"
        style="position: absolute; left: 0px; top: 0px"
      ></canvas>
    </div>
  </div>

  <script type="module" src="/script.js"></script>

  <a-scene>
   <script>
     
     const flipZone = 0.1; // percentage of screen where the coin flips
     
      AFRAME.registerComponent("nose", {
        tick: function () {
          if (this.previous === undefined) {
            this.previous = window.nose;
            return;
          }
        },
      });

      AFRAME.registerComponent("coin", {
        schema: {
          threshold: { type: "number", default: 0.5 },
        },
        init: function () {
          this.targetRotation = 0;
          this.currentRotation = 0;
        },
        tick: function () {
          if (!window.noseFound) return;

          //var nose = /1 - window.nose.x;
          var distance = Math.abs(this.data.threshold - (1 - window.nose.x));
          
          if (distance < flipZone ) {
            this.targetRotation = 0; // set target rotation to 300 degrees
          } else {
            this.targetRotation = 180; // set target rotation to 0 degrees
          }

          // Apply exponential moving average to smooth the rotation
          this.currentRotation =
            this.currentRotation * 0.95 + this.targetRotation * 0.05;

          // Set the new rotation directly in degrees
          this.el.setAttribute("rotation", {
            x: 0,
            y: this.currentRotation,
            z: 0,
          });
        },
      });
    </script>

    <a-entity nose></a-entity>
    <a-camera position="0 0 0" look-controls="enabled: false" wasd-controls="enabled: false"></a-camera>
    <a-entity position="-6 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.25" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="-3.9 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="-2.8 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="-1.7 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="-0.55 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="0.6 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="1.7 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="2.8 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="3.9 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.5" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    <a-entity position="6 0 -5" scale="0.5 0.5 0.5" coin="threshold:0.75" gltf-model="https://cdn.glitch.global/4d1e7f83-7113-4991-80d5-850464ae5b43/food%20rotated%20final%20final%202.glb?v=1729695348895"></a-entity>
    
    
  </a-scene>
</body>
